using Cabinink.Writer.Cores;
using Cabinink.Writer.Middle;
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Text;
using System.Windows.Forms;
using app = Cabinink.Program;
namespace Cabinink.Writer.UI
{
   public partial class frmNovelProperty : Cabinink.Writer.UI.VsSkinFormBase
   {
      private frmMainInterface owner;
      private Project project;
      public frmNovelProperty()
      {
         InitializeComponent();
      }
      public void Display(frmMainInterface _owner)
      {
         owner = _owner;
         project = owner.GetProjectAccessSelectedNode();
         Show();
      }
      private void frmNovelProperty_Load(object sender, EventArgs e)
      {
         LoadNovelInformation();
         LoadRoleCollection();
         //MessageBox.Show("SelectedNodeIndex=" + owner.trvNovelTree.SelectedNode.Index);
      }
      public void LoadNovelInformation()
      {
         txtProjectName.Text = project.Name;
         txtNovelName.Text = project.CurrentNovel.Information.NovelName;
         txtWriter.Text = project.CurrentNovel.Information.WriterName;
         txtCategory.Text = app.GetEnumDescription(project.CurrentNovel.Information.Category);
         txtCreateDate.Text = project.CurrentNovel.Information.CreationTime.ToLongDateString();
         txtKeywords.Text = project.CurrentNovel.Information.GetKeywordsCsvString();
         txtInfo.Text = project.CurrentNovel.Information.Remarks;
         txtSavedPath.Text = project.Database.SourceUri;
      }
      public void LoadRoleCollection()
      {
         RoleManagement roles = project.Roles;
         ListViewItem item;
         string name, camp, occup, appear, character, pet, other, appell, sex, initage, category;
         string[] itemstr;
         lsvRoles.Items.Clear();
         for (int i = 0; i < roles.Count; i++)
         {
            name = roles[i].Name.ToString(true);
            camp = roles[i].Camp;
            occup = roles[i].Occupation;
            appear = roles[i].Appearance;
            character = roles[i].Character;
            pet = roles[i].PetPhrase;
            other = roles[i].OtherInformation;
            appell = roles[i].GetCsvFormatString();
            sex = app.GetEnumDescription(roles[i].Sex);
            initage = roles[i].InitializeAge.ToString();
            category = app.GetEnumDescription(roles[i].Category);
            itemstr = new string[] { name, appell, sex, initage, category, camp, occup, appear, character, pet, other };
            item = new ListViewItem(itemstr);
            lsvRoles.Items.Add(item);
         }
      }

      private void 创建新角色ToolStripMenuItem_Click(object sender, EventArgs e)
      {
         frmCreateRole crtrole = new frmCreateRole(owner.GetProjectAccessSelectedNode());
         crtrole.ShowDialog(this);
         LoadRoleCollection();
      }

      private void 查看详情ToolStripMenuItem_Click(object sender, EventArgs e)
      {
         ListViewItem selected = lsvRoles.SelectedItems[0];
         string name = "姓名 = " + selected.SubItems[0].Text + "\n";
         string appell = "别称/昵称 = " + selected.SubItems[1].Text + "\n";
         string sex = "性别 = " + selected.SubItems[2].Text + "\n";
         string initage = "初始年龄 = " + selected.SubItems[3].Text + "\n";
         string category = "角色定位 = " + selected.SubItems[4].Text + "\n";
         string camp = "阵营/势力/国家 = " + selected.SubItems[5].Text + "\n";
         string occup = "职业 = " + selected.SubItems[6].Text + "\n";
         string appear = "外貌描写 = " + selected.SubItems[7].Text + "\n";
         string character = "性格特征 = " + selected.SubItems[8].Text + "\n";
         string pet = "口头禅/习惯用语 = " + selected.SubItems[9].Text + "\n";
         string other = "其他信息 = " + selected.SubItems[10].Text;
         string details_str = name + appell + sex + initage + category + camp + occup + appear + character + pet + other;
         frmRoleDetails details = new frmRoleDetails(details_str);
         details.Show(this);
      }
   }
}
